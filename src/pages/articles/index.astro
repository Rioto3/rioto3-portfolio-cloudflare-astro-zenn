---
import MainLayout from '../../layouts/MainLayout.astro';
import "../../styles/global.css";
import matter from 'gray-matter';

// „Çµ„Éñ„É¢„Ç∏„É•„Éº„É´„Å™„Å©„Åã„Çâ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÂèñÂæó„Åô„ÇãÈñ¢Êï∞
async function getArticles() {
  try {
    const articles = await import.meta.glob('../../content/articles/*.md', { as: 'raw' });
    if (Object.keys(articles).length > 0) {
      return articles;
    }
    
    // ‰ª£Êõø„Éë„Çπ„ÇíË©¶„ÅôÔºà„Çµ„Éñ„É¢„Ç∏„É•„Éº„É´„Åå„ÅÇ„ÇãÂ†¥ÂêàÔºâ
    return await import.meta.glob('../../../../content/articles/*.md', { as: 'raw' });
  } catch (error) {
    console.error("Ë®ò‰∫ã„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:", error);
    return {};
  }
}

const articles = await getArticles();
const articleEntries = await Promise.all(
  Object.entries(articles).map(async ([path, resolver]) => {
    const content = await resolver();
    const { data: frontmatter } = matter(content);
    
    return {
      frontmatter,
      path
    };
  })
);

// ÂÖ¨ÈñãÊ∏à„Åø„ÅÆË®ò‰∫ã„ÅÆ„Åø„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
const publishedArticles = articleEntries
  .filter(article => article.frontmatter.published !== false)
  .sort((a, b) => 
    new Date(b.frontmatter.date || 0) - new Date(a.frontmatter.date || 0)
  );
---

<MainLayout title="Ë®ò‰∫ã‰∏ÄË¶ß | Rioto3's Portfolio">
  <header class="mb-8">
    <h1 class="text-3xl font-bold">Ë®ò‰∫ã‰∏ÄË¶ß</h1>
  </header>
  
  <div class="space-y-6">
    {publishedArticles.map(article => (
      <article class="bg-white p-5 rounded-lg border hover:shadow-md transition-shadow">
        <a href={`/articles/${article.path.split('/').pop().replace('.md', '')}`} class="block">
          <div class="flex items-start gap-4">
            <span class="text-3xl flex-shrink-0 mt-1">{article.frontmatter.emoji || "üìù"}</span>
            <div>
              <h2 class="text-xl font-medium mb-2">{article.frontmatter.title}</h2>
              <div class="flex flex-wrap gap-2 mb-2">
                {article.frontmatter.topics?.map((topic) => (
                  <span class="inline-block bg-blue-50 text-blue-700 text-xs px-2 py-1 rounded-full">{topic}</span>
                ))}
              </div>
              <div class="flex items-center text-sm text-gray-500">
                <time datetime={article.frontmatter.date}>
                  {new Date(article.frontmatter.date || new Date()).toLocaleDateString('ja-JP')}
                </time>
                <span class="mx-2">‚Ä¢</span>
                <span>{article.frontmatter.type || "tech"}</span>
              </div>
            </div>
          </div>
        </a>
      </article>
    ))}
  </div>
  
  {publishedArticles.length === 0 && (
    <div class="text-center py-12 text-gray-500">
      <p>Ë®ò‰∫ã„Åå„Åæ„Å†„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
    </div>
  )}
</MainLayout>
